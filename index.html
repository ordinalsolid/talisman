<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Geological Glyph Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  background: #000;
  color: #eee;
  font-family: system-ui, sans-serif;
}

.container {
  max-width: 1500px;
  margin: auto;
  padding: 20px;
  display: flex;
  gap: 20px;
}

.sidebar {
  width: 320px;
  background: #111;
  border-radius: 14px;
  padding: 14px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.sidebar button {
  padding: 10px;
  border-radius: 8px;
  border: none;
  background: #333;
  color: #eee;
  cursor: pointer;
}

.assets {
  flex: 1;
  overflow-y: auto;
}

.assets-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
}

.asset {
  aspect-ratio: 1;
  background: #222;
  border-radius: 6px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px solid transparent;
}

.asset.selected {
  border-color: #aaa;
}

.asset img {
  width: 85%;
  height: 85%;
  object-fit: contain;
  pointer-events: none;
}

.canvas-wrap {
  flex: 1;
  display: flex;
  justify-content: center;
}

canvas {
  background: #000;
  border-radius: 18px;
}
</style>
</head>

<body>
<div class="container">

  <div class="sidebar">
    <button onclick="generate()">Regenerate Stone</button>
    <button onclick="clearAssets()">Clear Assets</button>

    <div class="assets">
      <div class="assets-grid" id="assetGrid"></div>
    </div>
  </div>

  <div class="canvas-wrap">
    <canvas id="canvas" width="720" height="1080"></canvas>
  </div>

</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let cavities = [];
let outline = [];
let placedAssets = {};
let hovered = null;
let selectedAsset = null;

const assetPaths = [
  "Spec_Geo_Assets/asset_star.png",
  "Spec_Geo_Assets/asset_moon.png",
  "Spec_Geo_Assets/asset_sun.png",
  "Spec_Geo_Assets/asset_flower.png",
  "Spec_Geo_Assets/asset_leaf.png",
  "Spec_Geo_Assets/asset_gem.png",
  "Spec_Geo_Assets/asset_wave.png",
  "Spec_Geo_Assets/asset_eye.png",
  "Spec_Geo_Assets/asset_shell.png",
  "Spec_Geo_Assets/asset_spiral.png",
  "Spec_Geo_Assets/asset_bone.png",
  "Spec_Geo_Assets/asset_cross.png"
];

const imgCache = {};
function loadImg(src) {
  if (imgCache[src]) return imgCache[src];
  const i = new Image();
  i.src = src;
  imgCache[src] = i;
  return i;
}

/* ---------- UI ---------- */
const grid = document.getElementById("assetGrid");
assetPaths.forEach(src => {
  const d = document.createElement("div");
  d.className = "asset";
  d.innerHTML = `<img src="${src}">`;
  d.onclick = () => {
    document.querySelectorAll(".asset").forEach(a => a.classList.remove("selected"));
    d.classList.add("selected");
    selectedAsset = src;
  };
  grid.appendChild(d);
});

/* ---------- GEOMETRY ---------- */
function dist(a,b){return Math.hypot(a.x-b.x,a.y-b.y)}

function organic(cx,cy,r,n=36){
  const pts=[];
  for(let i=0;i<n;i++){
    const a=i/n*Math.PI*2;
    const e=r*(0.65+Math.random()*0.55);
    pts.push({x:cx+Math.cos(a)*e,y:cy+Math.sin(a)*e});
  }
  return pts;
}

function drawPath(p){
  ctx.beginPath();
  ctx.moveTo(p[0].x,p[0].y);
  p.forEach(pt=>ctx.lineTo(pt.x,pt.y));
  ctx.closePath();
}

function inside(x,y,p){
  let c=false;
  for(let i=0,j=p.length-1;i<p.length;j=i++){
    ((p[i].y>y)!==(p[j].y>y)) &&
    x<(p[j].x-p[i].x)*(y-p[i].y)/(p[j].y-p[i].y)+p[i].x &&
    (c=!c);
  }
  return c;
}

/* ---------- GENERATION ---------- */
function generate(){
  cavities=[];
  placedAssets={};

  const count=6+Math.floor(Math.random()*5);
  let id=0;

  while(cavities.length<count){
    const r=40+Math.random()*40;
    const c={
      id:id++,
      x:canvas.width/2+(Math.random()-0.5)*320,
      y:canvas.height/2+(Math.random()-0.5)*480,
      r
    };
    if(cavities.every(o=>dist(c,o)>c.r+o.r+28)){
      c.shape=organic(c.x,c.y,c.r);
      cavities.push(c);
    }
  }

  buildOutline();
  draw();
}

function buildOutline(){
  outline=[];
  const cx=canvas.width/2;
  const cy=canvas.height/2;

  const steps=160;
  for(let i=0;i<steps;i++){
    const a=i/steps*Math.PI*2;
    let d=0;

    cavities.forEach(c=>{
      const dx=Math.cos(a)*(c.x-cx)+Math.sin(a)*(c.y-cy);
      const influence=Math.max(0,c.r*1.8-dx);
      d+=influence;
    });

    d=180+d*0.45+Math.random()*20;
    outline.push({
      x:cx+Math.cos(a)*d,
      y:cy+Math.sin(a)*d
    });
  }
}

/* ---------- TEXTURE ---------- */
function rockFill(){
  const g=ctx.createLinearGradient(0,0,0,canvas.height);
  g.addColorStop(0,"#555");
  g.addColorStop(1,"#111");
  ctx.fillStyle=g;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  for(let i=0;i<70000;i++){
    ctx.fillStyle=`rgba(${80+Math.random()*50},${80+Math.random()*50},${80+Math.random()*50},0.05)`;
    ctx.fillRect(Math.random()*canvas.width,Math.random()*canvas.height,1,1);
  }

  ctx.globalCompositeOperation="multiply";
  for(let y=0;y<canvas.height;y+=6){
    ctx.fillStyle=`rgba(0,0,0,${Math.random()*0.08})`;
    ctx.fillRect(0,y,canvas.width,3);
  }
  ctx.globalCompositeOperation="source-over";
}

/* ---------- DRAW ---------- */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#000";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  drawPath(outline);
  ctx.save();
  ctx.clip();
  rockFill();
  ctx.restore();

  cavities.forEach(c=>{
    drawPath(c.shape);
    ctx.fillStyle="#050505";
    ctx.fill();

    const g=ctx.createRadialGradient(c.x,c.y-c.r*0.3,c.r*0.2,c.x,c.y,c.r);
    g.addColorStop(0,"rgba(255,255,255,0.18)");
    g.addColorStop(1,"rgba(0,0,0,0.75)");
    ctx.fillStyle=g;
    ctx.fill();

    if(c===hovered){
      ctx.strokeStyle="rgba(255,255,255,0.4)";
      ctx.lineWidth=2;
      ctx.stroke();
    }

    const p=placedAssets[c.id];
    if(p){
      const img=loadImg(p.src);
      const size=c.r*2*(1.25-p.depth*0.35);
      ctx.save();
      ctx.translate(c.x,c.y);
      ctx.shadowColor="rgba(0,0,0,0.9)";
      ctx.shadowBlur=30*p.depth;
      ctx.shadowOffsetY=14*p.depth;
      ctx.drawImage(img,-size/2,-size/2,size,size);
      ctx.restore();
    }
  });
}

/* ---------- INTERACTION ---------- */
canvas.onmousemove=e=>{
  const r=canvas.getBoundingClientRect();
  const x=e.clientX-r.left;
  const y=e.clientY-r.top;
  hovered=cavities.find(c=>inside(x,y,c.shape))||null;
  draw();
};

canvas.onclick=e=>{
  if(!selectedAsset||!hovered)return;
  const r=canvas.getBoundingClientRect();
  const x=e.clientX-r.left;
  const y=e.clientY-r.top;
  const d=Math.hypot(x-hovered.x,y-hovered.y);
  placedAssets[hovered.id]={src:selectedAsset,depth:Math.min(1,d/hovered.r)};
  draw();
};

function clearAssets(){
  placedAssets={};
  draw();
}

generate();
</script>
</body>
</html>



